"use strict";function o(e){e=Math.round(255*e);var t=e.toString(16);return 1==t.length?"0"+t:t}function m(e){return"#"+o(e[0])+o(e[1])+o(e[2])}function k(e){return 1.5*e*1.3806488e-23*624150934e10}function c(e){return 2*e/3/1.3806488e-23/624150934e10}function d(t){var e=Math.round(100*t.molecule/(t.molecule+t.substrate));$("#energy_molecule .bar").width(String(e)+"%"),$("#energy_substrate .bar").width(String(100-e)+"%"),$("#energy_molecule .label").text(String(e)+"%"),$("#energy_substrate .label").text(String(100-e)+"%")}var e={create:function(a,t){var e=$(a),i=this;t=t||{},this.shader=t.hasOwnProperty("shader")?t.shader:"phong",this.drawingType=t.hasOwnProperty("drawingType")?t.drawingType:"ball and stick",this.cameraType=t.hasOwnProperty("cameraType")?t.cameraType:"perspective",this.updateCamera="orthographic"===this.cameraType,this.shininess=t.hasOwnProperty("shininess")?t.shininess:30,this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setSize(e.width(),e.height()),e.append(this.renderer.domElement),this.perspective=new THREE.PerspectiveCamera(50,e.width()/e.height()),this.orthographic=new THREE.OrthographicCamera(-e.width()/32,e.width()/32,e.height()/32,-e.height()/32,-100,1e3),this.orthographic.z=10,this.sphereGeometry=new THREE.SphereGeometry(1,16,12),this.cylinderGeometry=new THREE.CylinderGeometry(1,1,1,6,3,!1),this.cylinderGeometry.applyMatrix((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(Math.PI/2,Math.PI,0))),this.light=new THREE.HemisphereLight(16777215,1),this.light.position.set(-30,30,40),this.directionalLight=new THREE.DirectionalLight(16777215,.6),this.directionalLight.position.set(30,30,40),this.atoms=[],this.bonds=[],this.scene=new THREE.Scene,this.scene.add(this.perspective),this.scene.add(this.orthographic),this.setCameraType("perspective"),this.makeMaterials(),$(window).resize(function(){i.renderer.setSize(e.width(),e.height()),i.perspective.aspect=e.width()/e.height(),i.perspective.updateProjectionMatrix(),i.orthographic.left=-e.width()/32,i.orthographic.right=e.width()/32,i.orthographic.top=e.height()/32,i.orthographic.bottom=-e.height()/32,i.orthographic.updateProjectionMatrix()}),this.animate()},makeMaterials:function(){var t,e=this;if(-1!==$.inArray(e.shader,["basic","phong","lambert"]))t="Mesh"+e.shader.charAt(0).toUpperCase()+e.shader.slice(1)+"Material","phong"==e.shader?$.each(e.data,function(a,i){i.material=new THREE[t]({color:i.color,shininess:e.shininess})}):$.each(e.data,function(i,e){e.material=new THREE[t]({color:e.color})});else{if("toon"!==this.shader)throw new Error(this.shader+" shader does not exist. Use 'toon', 'basic', 'phong', or 'lambert'.");$.each(this.data,function(a,e){var i,t;i=THREE.ShaderToon.toon2,t=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}),t.uniforms.uDirLightPos.value.set(1,1,1).multiplyScalar(15),e.color=new THREE.Color(e.color),t.uniforms.uDirLightColor.value=e.color,t.uniforms.uBaseColor.value=e.color,e.material=t})}},draw:function(i,_){var t,e,r,w,s,n,g,h,u,o,a,l,p,m,f,d,c,v;if(e=this,h=new THREE.Vector3,this.current=i,w="space filling"===this.drawingType?1:.3,i.hasOwnProperty("bonds")||(i.bonds=[]),d=0,c=0,$.each(i.atoms,function(a,i){u=e.data[i.element]||e.data.unknown,t=new THREE.Mesh(e.sphereGeometry,u.material),t.position.fromArray(i.location),t.scale.set(1,1,1).multiplyScalar(w*u.radius*2),"wireframe"!==e.drawingType&&e.scene.add(t),t.element=i.element,e.atoms.push(t),d=Math.max(d,Math.abs(i.location[0]),Math.abs(i.location[1])),c=Math.max(c,i.location[2])}),("undefined"==typeof _||_)&&(v=(d/Math.tan(Math.PI*e.camera.fov/360)+c)/.8,e.perspective.position.z=v),$.each(i.bonds,function(a,i){for(r=[e.atoms[i.atoms[0]],e.atoms[i.atoms[1]]],s=0;s<i.order;s+=1)for(g=2===i.order?.5*(1===s?1:-1):3===i.order&&0!==s?1===s?1:-1:0,n=0;2>n;n+=1)t=new THREE.Mesh(e.cylinderGeometry,e.data.bond.material),h.addVectors(r[0].position,r[1].position).divideScalar(2),t.atomMaterial=e.data[r[n].element].material,t.position.addVectors(h,r[n].position).divideScalar(2),t.lookAt(r[1].position),t.scale.x=t.scale.y=.3*e.data.bond.radius*2,t.scale.z=r[1].position.distanceTo(r[0].position)/2,t.translateY(.3*g),"wireframe"===e.drawingType&&(t.material=t.atomMaterial),"space filling"!==e.drawingType&&e.scene.add(t),e.bonds.push(t)}),i.hasOwnProperty("periodic_connections")&&(i.unitcell=i.periodic_connections,delete i.periodic_connections),i.hasOwnProperty("unitcell")){for(o=new THREE.Vector3(0,0,0),a=[o.clone().fromArray(i.unitcell[0]),o.clone().fromArray(i.unitcell[1]),o.clone().fromArray(i.unitcell[2])],l=[o.clone(),a[0],a[1],a[2],o.clone().add(a[0]).add(a[1]).add(a[2]),o.clone().add(a[1]).add(a[2]),o.clone().add(a[0]).add(a[2]),o.clone().add(a[0]).add(a[1])],p=l[4].clone().multiplyScalar(.5),s=0;s<l.length;s+=1)l[s].sub(p);m=new THREE.Geometry,$.each([0,1,0,2,0,3,6,1,7,2,5,3,5,4,6,4,7],function(t,e){m.vertices.push(l[e])}),f=new THREE.LineBasicMaterial({color:0,linewidth:3}),this.corners=new THREE.Line(m,f),this.scene.add(this.corners)}this.updateCamera&&(this.setCameraType(this.cameraType),this.updateCamera=!1)},clear:function(){var e=this;$.each(this.atoms.concat(this.bonds),function(i,t){e.scene.remove(t)}),this.atoms=[],this.bonds=[],this.scene.remove(this.corners)},setDrawingType:function(t){var e;if("ball and stick"===this.drawingType){if("wireframe"===t){for(e=0;e<this.atoms.length;e+=1)this.scene.remove(this.atoms[e]);for(e=0;e<this.bonds.length;e+=1)this.bonds[e].material=this.bonds[e].atomMaterial}else if("space filling"===t){for(e=0;e<this.atoms.length;e+=1)this.atoms[e].scale.divideScalar(.3);for(e=0;e<this.bonds.length;e+=1)this.scene.remove(this.bonds[e])}}else if("wireframe"===this.drawingType){if("ball and stick"===t){for(e=0;e<this.atoms.length;e+=1)this.scene.add(this.atoms[e]);for(e=0;e<this.bonds.length;e+=1)this.bonds[e].material=this.data.bond.material}else if("space filling"===t){for(e=0;e<this.atoms.length;e+=1)this.atoms[e].scale.divideScalar(.3),this.scene.add(this.atoms[e]);for(e=0;e<this.bonds.length;e+=1)this.scene.remove(this.bonds[e])}}else if("space filling"===this.drawingType)if("ball and stick"===t){for(e=0;e<this.atoms.length;e+=1)this.atoms[e].scale.multiplyScalar(.3);for(e=0;e<this.bonds.length;e+=1)this.bonds[e].material=this.data.bond.material,this.scene.add(this.bonds[e])}else if("wireframe"===t){for(e=0;e<this.atoms.length;e+=1)this.atoms[e].scale.multiplyScalar(.3),this.scene.remove(this.atoms[e]);for(e=0;e<this.bonds.length;e+=1)this.bonds[e].material=this.bonds[e].atomMaterial,this.scene.add(this.bonds[e])}this.drawingType=t},setCameraType:function(e){"orthographic"===e?(this.camera=this.orthographic,this.camera.position.copy(this.perspective.position)):"perspective"===e&&(this.camera=this.perspective,this.camera.position.copy(this.orthographic.position)),this.controls=new THREE.TrackballControls(this.camera,this.renderer.domElement),this.camera.add(this.light),this.camera.add(this.directionalLight)},setShader:function(e){this.shader=e,this.makeMaterials(),this.clear(),this.draw(this.current,!1)},animate:function(){var e=this;window.requestAnimationFrame(function(){return e.animate()}),this.controls.update(),this.renderer.render(this.scene,this.camera)},showUnitCell:function(e){this.scene[e?"add":"remove"](this.corners)},connect:function(t){var e=this;this.socket=new WebSocket("ws://"+window.location.hostname+":"+t+"/websocket"),this.queue={},this.socket.onopen=function(){console.log("Connected!")},this.socket.onmessage=function(s){var i,t,a;t=$.parseJSON(s.data),i=e.queue[t.id],delete e.queue[t.id],e.result=t.result,t.error?alert(t.result):"draw"===i?(e.clear(),e.draw(t.result)):"save"===i?(a=t.result.hasOwnProperty("name")&&""!==t.result.name?t.result.name:e.filename,saveAs(new Blob([e.result],{type:"text/plain"}),a+"."+e.outFormat)):alert("Unsupported function: "+i)}},convertAndDraw:function(e,t){if("json"===t)return this.clear(),void this.draw($.parseJSON(e));var i=this.uuid();this.socket.send(JSON.stringify({method:"convert",id:i,params:{data:e,in_format:t,out_format:"object",pretty:!1}})),this.queue[i]="draw"},convertAndSave:function(i,e){var t=this.uuid();this.socket.send(JSON.stringify({method:"convert",id:t,params:{data:i,in_format:"json",out_format:e,pretty:!0}})),this.outFormat=e,this.queue[t]="save"},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"==t?e:3&e|8;return i.toString(16)})},data:{Ac:{color:7383801,radius:1.95},Ag:{color:12566463,radius:1.6},Al:{color:12559781,radius:1.25},Am:{color:5528562,radius:1.75},Ar:{color:8442338,radius:.71},As:{color:12353762,radius:1.15},Au:{color:16765219,radius:1.35},B:{color:16758197,radius:.85},Ba:{color:51200,radius:2.15},Be:{color:12713728,radius:1.05},Bi:{color:10375093,radius:1.6},Br:{color:10823720,radius:1.15},C:{color:9474192,radius:.7},Ca:{color:4062976,radius:1.8},Cd:{color:16767118,radius:1.55},Ce:{color:16777158,radius:1.85},Cl:{color:2092831,radius:1},Co:{color:15700128,radius:1.35},Cr:{color:9017798,radius:1.4},Cs:{color:5642126,radius:2.6},Cu:{color:13140019,radius:1.35},Dy:{color:2097094,radius:1.75},Er:{color:58997,radius:1.75},Eu:{color:6356934,radius:1.85},F:{color:9494351,radius:.5},Fe:{color:14640691,radius:1.4},Ga:{color:12684942,radius:1.3},Gd:{color:4521926,radius:1.8},Ge:{color:6721166,radius:1.25},H:{color:16777215,radius:.25},Hf:{color:5095935,radius:1.55},Hg:{color:12105935,radius:1.5},Ho:{color:65436,radius:1.75},I:{color:9633939,radius:1.4},In:{color:10843506,radius:1.55},Ir:{color:1528967,radius:1.35},K:{color:9322452,radius:2.2},La:{color:7394559,radius:1.95},Li:{color:13402367,radius:1.45},Lu:{color:43555,radius:1.75},Mg:{color:9043712,radius:1.5},Mn:{color:10254790,radius:1.4},Mo:{color:5551541,radius:1.45},N:{color:3100663,radius:.65},Na:{color:11164658,radius:1.8},Nb:{color:7520712,radius:1.45},Nd:{color:13041606,radius:1.85},Ni:{color:5230415,radius:1.35},Np:{color:33023,radius:1.75},O:{color:16715021,radius:.6},Os:{color:2516629,radius:1.3},P:{color:16744448,radius:1},Pa:{color:41471,radius:1.8},Pb:{color:5658976,radius:1.8},Pd:{color:27013,radius:1.4},Pm:{color:10747846,radius:1.85},Po:{color:11164416,radius:1.9},Pr:{color:14221254,radius:1.85},Pt:{color:13619167,radius:1.35},Pu:{color:27647,radius:1.75},Ra:{color:31744,radius:2.15},Rb:{color:7351727,radius:2.35},Re:{color:2522282,radius:1.35},Rh:{color:687244,radius:1.35},Ru:{color:2330254,radius:1.3},S:{color:16777007,radius:1},Sb:{color:10379957,radius:1.45},Sc:{color:15132390,radius:1.6},Se:{color:16752896,radius:1.15},Si:{color:15714464,radius:1.1},Sm:{color:9371590,radius:1.85},Sn:{color:6717568,radius:1.45},Sr:{color:65280,radius:2},Ta:{color:5088767,radius:1.45},Tb:{color:3145670,radius:1.75},Tc:{color:3907230,radius:1.35},Te:{color:13924608,radius:1.4},Th:{color:47871,radius:1.8},Ti:{color:12566982,radius:1.4},Tl:{color:10835021,radius:1.9},Tm:{color:54354,radius:1.75},U:{color:36607,radius:1.75},V:{color:10855850,radius:1.35},W:{color:2200534,radius:1.35},Y:{color:9699327,radius:1.8},Yb:{color:48952,radius:1.75},Zn:{color:8159407,radius:1.35},Zr:{color:9691103,radius:1.55},bond:{color:789516,radius:.18},unknown:{color:0,radius:.8}}};$(document).ready(function(){function u(e,t){$.MODE="structure",e in $.STRUCTURES?($.CFG_debug>0&&console.log("structure viewer: loading cached molecule "+e),p(m($.STRUCTURES[e]),t)):($("#structure_loading").show(),$.getJSON("json/"+e,function(i){i=m(i),$.STRUCTURES[e]=i,p(i,t)}))}function p(t,i){"structure"==$.MODE&&($("#colorscale_time").hide(),$("#colorscale_single").hide(),$("#energy_molecule_substrate").hide(),i&&n(),$.MOLECULE=t,e.clear(),e.draw(t),e.controls.noPan=!0,$.CAM_INITIAL_Z=e.camera.position.z,i?c():(e.camera.position.set(0,0,1*$.CAM_INITIAL_Z),e.camera.up.set(0,1,0)),window.setTimeout(function(){e.controls.update(),e.renderer.render(e.scene,e.camera),e.renderer.setSize($("#imolecule").width(),$("#imolecule").height())},2e3)),$("#structure_loading").hide()}function E(){n(),e.clear(),e.draw($.MOLECULE),e.controls.noPan=!0,$.CAM_INITIAL_Z=e.camera.position.z,c()}function m(t){return $.each(t.bonds,function(i,e){t.bonds[i].order="Ag"==t.atoms[e.atoms[0]].element||"Ag"==t.atoms[e.atoms[0]].element?0:1}),e.data.H.color=15132160,e.data.C.color=6447714,e.data.Ag.color=1052688,e.data.bond.color=15790320,e.makeMaterials(),r(),t}function r(){"ball and stick"==$("#drawing-types").find(":selected").text()?(e.data.Ag.radius=1.6*1.5,e.data.C.radius=.7*1.15,e.data.H.radius=.3625,e.data.bond.radius=.288):"space filling"==$("#drawing-types").find(":selected").text()?(e.data.Ag.radius=.8,e.data.C.radius=.42,e.data.H.radius=.15,e.data.bond.radius=.18):"wireframe"==$("#drawing-types").find(":selected").text()&&(e.data.bond.radius=.36)}function h(){$.CAM_POS=e.camera.position.clone(),$.CAM_ROT=e.camera.rotation.clone(),$.CAM_UP=e.camera.up.clone(),$.CAM_ALL=e.camera.clone()}function n(){$.CAM_POS_TEMP=e.camera.position.clone(),$.CAM_ROT_TEMP=e.camera.rotation.clone(),$.CAM_UP_TEMP=e.camera.up.clone()}function _(){$.CAM_POS!==!1&&(e.camera.position.copy($.CAM_POS),e.camera.rotation.copy($.CAM_ROT),e.camera.up.copy($.CAM_UP))}function c(){$.CAM_POS_TEMP!==!1&&(e.camera.position.copy($.CAM_POS_TEMP),e.camera.rotation.copy($.CAM_ROT_TEMP),e.camera.up.copy($.CAM_UP_TEMP))}function i(t){var i=1,a=(new Date).getTime()/1e3;a-$.XYZ_CLICKED[t]<$.CLICKED_MAX&&(i=-$.XYZ_FAC[t]),"z"==t?(e.camera.position.set(0,0,i*$.CAM_INITIAL_Z),e.camera.up.set(0,1,0)):"x"==t?(e.camera.position.set(i*$.CAM_INITIAL_Z,0,0),e.camera.up.set(0,0,1)):"y"==t&&(e.camera.position.set(0,i*$.CAM_INITIAL_Z,0),e.camera.up.set(0,0,1)),e.camera.rotation.set(0,0,0),$.XYZ_CLICKED[t]=(new Date).getTime()/1e3,$.XYZ_FAC[t]=i}function a(){$("#description").toggle("slide",{duration:400,easing:"easeInOutCubic"}),$("#description_smallmenu").toggle("slide",{duration:400,easing:"easeInOutCubic"})}function s(i){var e=$("#slider_speed").slider("option","step"),t=$("#slider_speed").slider("option","value");if(1==i){var a=$("#slider_speed").slider("option","max");a>=t+e?$("#slider_speed").slider("option","value",t+e):$("#slider_speed").slider("option","value",a)}else if(-1===i){var s=$("#slider_speed").slider("option","min");t-e>=s?$("#slider_speed").slider("option","value",t-e):$("#slider_speed").slider("option","value",s)}}function d(e){"switch"==e?t.animating?t.animation_stop():($.MODE="dissipation_animation",f(),t.animate($("#slider_time").slider("option","value"),!0)):"start"==e?$("#anim_start").text("Stop"):"stop"==e&&$("#anim_start").text("Start")}function y(e){$("#slider_speed").slider("option","value",Math.pow(e,$.SPEED_POWER))}function g(e,t){$("#slider_speed").slider("option","min",Math.pow(e,$.SPEED_POWER)),$("#slider_speed").slider("option","max",Math.pow(t,$.SPEED_POWER))}function w(e){$.SLIDER_TIME_USING||($("#slider_time").slider("option","value",e),$("#slider_simulated_time").text(e)),$("#simulated_time").text(e)}function v(e,t,i){$("#slider_time").slider("option","min",e),$("#slider_time").slider("option","max",t),$("#slider_time").slider("option","step",i)}function f(){t.setup("../dissipation_animation/2b_3a/T_mean5.dat","dissipation_animation/2b_3a/json_files_mean/md_mean5_%NUM%.xyz.json",5,0,2080)}$.CFG_debug=1,$.CFG_shininess=10,$.MODE="structure",$.CAM_POS=!1,$.CAM_INITIAL_Z=10;var o=(new Date).getTime()/1e3;$.XYZ_CLICKED={x:o,y:o,z:o},$.XYZ_FAC={x:1,y:1,z:1},$.CLICKED_MAX=2,$.SLIDER_TIME_USING=!1,$.SPEED_POWER=.5,$.STRUCTURES={};try{e.create("#imolecule",{shader:"phong",shininess:$.CFG_shininess}),$.imolecule=e,$.dissipation_animation=t}catch(M){$("#description").hide(),$("#error_webgl").show()}$.fn.adjust_radii=r,$.fn.save_cam_temp=n,$.fn.restore_cam_temp=c,$("#camera-type").bind("change",function(){e.setCameraType($("#camera-type").find(":selected").text())}),$("#drawing-types").bind("change",function(){r(),"dissipation_animation"==$.MODE?t.adjust_radii($.MOLECULE):"dissipation"==$.MODE&&l.adjust_radii($.MOLECULE),e.clear(),e.setDrawingType($("#drawing-types").find(":selected").text()),e.draw($.MOLECULE)}),$.fn.xyz_click=i,$("#cam_z").bind("click",function(){i("z")}),$("#cam_y").bind("click",function(){i("y")}),$("#cam_x").bind("click",function(){i("x")}),$("#cam_mem").bind("click",function(){h()}),$("#cam_rcl").bind("click",function(){_()}),$(document).bind("keydown",function(e){0==e.shiftKey&&0==e.altKey&&0==e.ctrlKey&&(88==e.which?(e.preventDefault(),i("x")):89==e.which?(e.preventDefault(),i("y")):90==e.which?(e.preventDefault(),i("z")):82==e.which?(e.preventDefault(),_()):83==e.which?(e.preventDefault(),d("switch")):77==e.which?(e.preventDefault(),a()):219==e.which?(e.preventDefault(),s(-1)):221==e.which&&(e.preventDefault(),s(1))),1==e.shiftKey&&0==e.altKey&&0==e.ctrlKey&&77==e.which&&(e.preventDefault(),h())}),$("#description_smallmenu").bind("click",function(){a()}),$("#description_close").bind("click",function(){a()}),$.fn.show_hide_menu=a,$.fn.dissipation_animation_speed=s,$("#anim_start").bind("click",function(){d("switch")}),$.fn.dissipation_animation_startstop=d,$("#slider_speed").slider({animate:"fast",max:17.3,min:0,step:.1,value:5.3}),$("#slider_time").slider({animate:"fast",max:2080,min:0,step:5}),$("#slider_shininess").slider({animate:"fast",max:100,min:0,step:1,value:$.CFG_shininess}),$("#slider_shininess").on("slidestop",function(i,t){e.shininess=t.value,e.makeMaterials(),E()}),$("#slider_speed").on("slidechange",function(i,e){t.speed=Math.pow(e.value,1/$.SPEED_POWER)}),$.fn.slider_speed_set=y,$.fn.slider_speed_setminmax=g,$("#slider_time").on("slidestart",function(){$.SLIDER_TIME_USING=!0}),$("#slider_time").on("slidestop",function(i,e){t.animating?t.simulated_time=e.value:($.MODE="dissipation_animation",f(),t.animate(e.value,!1)),$.SLIDER_TIME_USING=!1}),$("#slider_time").on("slide",function(t,e){$.SLIDER_TIME_USING=!0,$("#slider_simulated_time").text(e.value)}),$.fn.slider_time_set=w,$.fn.slider_time_set_minmaxstep=v;var b=["1","2a","2b","2b-dag","3a","3b","3c","3c-dag","4a","4b","4c"];b.forEach(function(e){var t=e.replace("-dag","<sup>&Dagger;</sup>");$("<a>",{html:t,title:e,href:"#",click:function(){return u(e+".json",!0),!1}}).appendTo("#structure_links")});var T=["2a","2b","3a","3b","3c","4a","4c"];T.forEach(function(e){var t=e;$("<a>",{text:t,title:e,href:"#",click:function(){return l.show(e,"dissipation/"+e+"/avg.xyz.json","../dissipation/"+e+"/avg.dat"),!1}}).appendTo("#structure_links_dissipation")}),u("1.json",!1)});var A=4e4,s=7.7363,S=400,n=0,T=[[.04,.04,.09],[.846,.186,.137],[.961,1,.137],[.99,1,.148],[1,1,.8]],E=[0,.56,.71,.85,1],w=[1,1,.8],g=[[.04,.04,.09],[.846,.186,.137],[.961,1,.137],[.99,1,.148]],_=[0,.25,.58,1],M=[1,1,.8],f=!0,I=[.001,.01,.1],h=[];$.map(I,function(e,t){h[t]=c(e)});var v=["10<sup>-3</sup>","10<sup>-2</sup>","10<sup>-1</sup>"],y=[0,.01,.02,.03,.04,.05],u=[];$.map(y,function(e,t){u[t]=c(e)});var b=["0","0.01","0.02","0.03","0.04","0.05"],i=$.CFG_debug,p=28,x=300,C=0,r=60,a=.2,P=192,R=56,O=256,D=56,t={read_temperatures:function(t){{var e=this;Papa.parse(t,{dynamicTyping:!0,worker:!0,download:!0,delimiter:" ",complete:function(t){for(var i=0;i<t.data.length;i++)for(var a=0;a<t.data[i].length;a++)t.data[i][a]=parseFloat(t.data[i][a]);e.temperatures=t.data,e.colors=e.make_colors(e.temperatures,!1,f,"colorscale_animation"),e.energy_molecule_substrate=e.calc_energy_molecule_substrate(e.temperatures,D,O)}})}},read_positions:function(s,o,c,r){function n(e,i){i.done(function(i){0===e&&$.fn.adjust_radii(),t.molecules[e]=t.animation_special_style_prework(i),t.molecules_parsed[e]=1})}for(var e=0;e<this.numEntries;e++){var l=o+e*r,i=s.replace("%NUM%",l),t=this,a=$.getJSON(i);n(e,a),a.fail(function(r,a,s){t.molecules_parsed[e]=-1;var o=a+", "+s;console.log("Request Failed: "+o+" | "+i)})}},calc_energy_molecule_substrate:function(a,r,s){for(var o=[],t=0;t<a.length;t++){for(var i={molecule:0,substrate:0},e=0;e<a[t].length;e++)s>e?i.substrate=i.substrate+a[t][e]:s+r>e&&(i.molecule=i.molecule+a[t][e]);o.push(i)}return o},make_colors:function(a,v,c,y){var u=[];if(c)var r=A,l=s,f=T,p=E,$=w;else var r=S,l=n,f=g,p=_,$=M;if(v)o=r;else{for(var o=0,t=0;t<a.length;t++)for(var i=0;i<a[t].length;i++)a[t][i]>o&&(o=a[t][i]);o>r&&(o=r)}for(var d=[],t=0;t<f.length;t++)d.push(m(f[t]));if(c)var h=chroma.scale(d,p).domain([l,o],1e4,"log");else var h=chroma.scale(d,p).domain([l,o]);for(var t=0;t<a.length;t++){u[t]=[];for(var i=0;i<a[t].length;i++)u[t][i]=a[t][i]<l?parseInt(h(l).hex().substring(1),16):a[t][i]>r?m($):parseInt(h(a[t][i]).hex().substring(1),16)}return e.data.bond.color=15790320,this.draw_colorscale(h,o,c,y),u},draw_colorscale:function(y,a,l,r){for(var c=document.getElementById(r),i=c.getContext("2d"),o=c.width,t=c.height,p=$("#"+r),f="#"+r+"_captions",E=$(f),T=(p.width(),p.height()),_=0,e=0;t>e;e++)_=l?Math.exp(Math.log(s)+e/t*(Math.log(a)-Math.log(s))):e/t*(a-n),i.fillStyle=y(_).hex(),i.fillRect(0,t-e,o/2.5,1);i.fillStyle="#c0c0c0";var m=0,d=0,g=0;if($(f+"> .colorscale_ticks").remove(),l)var w=h,M=v;else var w=u,M=b;for(e=0;e<w.length;e++)d=w[e],m=l?(Math.log(d)-Math.log(s))/(Math.log(a)-Math.log(s))*t:d*t/(a-n),i.fillRect(o*(.4-.05),t-m,o/10,2),g=((t-m)*T/t+10).toFixed(1),E.append('<div class="colorscale_ticks" style="position:absolute;left:60px;top:'+g+'px;">'+M[e]+"</div>")},animation_special_style_prework:function(t){$.each(t.bonds,function(i,e){t.bonds[i].order="Ag"==t.atoms[e.atoms[0]].element||"Ag"==t.atoms[e.atoms[0]].element?0:1});for(var o={Ag:0,C:0,H:0},i=0;i<t.atoms.length;i++){var a=t.atoms[i].element,s=a+"_"+o[a];t.atoms[i].element_orig=a,t.atoms[i].element=s,void 0===e.data[s]&&(e.data[s]={color:e.data[a].color}),o[a]++}return t},adjust_radii:function(i){for(var t=0;t<i.atoms.length;t++){var a=i.atoms[t].element_orig,s=i.atoms[t].element;e.data[s].radius=e.data[a].radius}},animation_special_style:function(a,s){for(var t=0;t<a.atoms.length;t++){var i=a.atoms[t].element;void 0===e.data[i]&&(e.data[i]=[]),e.data[i].color=s[t]}e.makeMaterials()},animation_step:function(){if("dissipation_animation"!=$.MODE)return this.animation_stop(),!1;var s=this;if(this.animating){var o=(new Date).getTime()-this.time_laststep;this.time_laststep=(new Date).getTime(),this.simulated_time=this.simulated_time+o*this.speed/1e3}var t=Math.floor(this.simulated_time/this.n_data);if(this.laststep)return this.animation_stop(),!1;if(t!=this.i_frame){t>=this.molecules.length&&(t=this.molecules.length-1,this.laststep=!0);var a=t+Math.floor(this.frame_start/this.n_data),r=this.frame_start+t*this.n_data;$.fn.slider_time_set(Math.round(r));var i=this.molecules[t],n=this.colors[a];$.fn.save_cam_temp(),this.animation_special_style(i,n),$.MOLECULE=i,e.clear(),e.draw(i),e.controls.noPan=!0,$.fn.restore_cam_temp(),d(this.energy_molecule_substrate[a]),this.i_frame=t}this.animating&&(this.timeout=window.requestAnimationFrame(function(){s.animation_step()}))},setup:function(o,r,e,t,a){if(this.setup_started)return!1;i>0&&console.log("dissipation_animation: setting up animation."),this.setup_started=!0,this.setup_started_time=(new Date).getTime(),this.setup_done=!1,this.n_data=e,this.frame_start=t,this.frame_end=a,this.temperatures=null,this.colors=null,this.energy_molecule_substrate=null,this.numEntries=Math.floor((a-t)/e)+1,this.molecules=new Array(this.numEntries),this.molecules_parsed=[];for(var s=0;s<this.numEntries;s++)this.molecules_parsed.push(0);this.read_temperatures(o),this.read_positions(r,t,a,e),this.waitloops=0,this.speed=p,this.animating=!1,this.simulated_time=0,this.i_frame=-1,this.laststep=!1,this.timeout=null,this.timeout_animationframe=null,$.fn.slider_speed_setminmax(C,x),$.fn.slider_speed_set(this.speed),$.fn.slider_time_set_minmaxstep(0,(this.numEntries-1)*e,e)},animation_stop:function(){this.animating=!1,$.fn.dissipation_animation_startstop("stop")},animate:function(e,s){var o=this;this.timeouot&&(clearTimeout(this.timeout),this.timeout=null),this.timeout_animationframe&&(cancelAnimationFrame(this.timeout_animationframe),this.timeout_animationframe=null);var t={},c=this.molecules_parsed;t[1]=0;for(var n=0;n<c.length;n++){var l=c[n];t[l]=t[l]?t[l]+1:1}if(!this.temperatures||t[0]>0){$("#animation_loading").show();var d=t[1]/this.numEntries;this.temperatures||(d/=1.02),$("#animation_loading_percentage").text(Math.round(100*d)+"%"),this.waitloops++;var u=(new Date).getTime();this.waitloops<r/a||u-this.setup_started_time<1e3*r?(i>0&&console.log("dissipation_animation: waiting for data being parsed."),setTimeout(function(){o.timeout=o.animate(e,s)},1e3*a)):(console.log("dissipation_animation: could not parse data (timeout)."),$("#animation_loading").text("Timeout."))}else{if(this.setup_done=!0,$("#animation_loading").hide(),"dissipation_animation"!=$.MODE)return!1;void 0===e&&(e=0),0>e&&(e=0),e>=(this.numEntries-1)*this.n_data&&s===!0&&(e=0),this.adjust_radii(this.molecules[0]),$("#colorscale_single").hide(),$("#colorscale_time").show(),$("#energy_molecule_substrate").show(),s?($.fn.dissipation_animation_startstop("start"),this.animating=!0,i>0&&console.log("dissipation_animation: starting animation at t="+e)):(this.animating=!1,i>0&&console.log("dissipation_animation: displaying t="+e)),this.laststep=!1,this.simulated_time=e,this.animation_starttime=(new Date).getTime(),this.time_laststep=(new Date).getTime(),window.requestAnimationFrame(function(){o.animation_step()})}}},l={setup:function(){this.molecules={},this.molecules_parsing={},this.molecules_waitloops={},this.temperatures={},this.energy_molecule_substrate={},this.colors={},this.timeout=null},animation_special_style_prework:function(e){return t.animation_special_style_prework(e)},animation_special_style:function(e,i){return t.animation_special_style(e,i)},adjust_radii:function(e){return t.adjust_radii(e)},make_colors:function(e){return t.make_colors(e,!0,!1,"colorscale_dissipation_single")},calc_energy_molecule_substrate:function(e,i,a){return t.calc_energy_molecule_substrate(e,i,a)},show:function(t,o,n){if($.MODE="dissipation",this.molecules_parsing||this.setup(),this.timeouot&&(clearTimeout(this.timeout),this.timeout=null),t in this.molecules_parsing)if(3==this.molecules_parsing[t])"dissipation"==$.MODE&&(i>0&&console.log("dissipation: displaying "+t),$("#colorscale_time").hide(),$("#colorscale_single").show(),d(this.energy_molecule_substrate[t]),$("#energy_molecule_substrate").show(),this.adjust_radii(this.molecules[t]),$.fn.save_cam_temp(),this.animation_special_style(this.molecules[t],this.colors[t]),$.MOLECULE=this.molecules[t],e.clear(),e.draw(this.molecules[t]),e.controls.noPan=!0,$.fn.restore_cam_temp()),$("#dissipation_loading").hide();else if(this.molecules_waitloops[t]++,this.molecules_waitloops[t]<r/a){var l=this.molecules_parsing[t]/3;$("#dissipation_loading_percentage").text(Math.round(100*l)+"%"),i>0&&console.log("dissipation: waiting for data being parsed.");var s=this;setTimeout(function(){s.timeout=s.show(t,o,n)},1e3*a)}else console.log("dissipation: could not parse data (timeout)."),$("#dissipation_loading").text("Timeout.");else{this.molecules_parsing[t]=1,this.molecules_waitloops[t]=0,$("#dissipation_loading").show();var s=this;$.getJSON(o,function(e){s.molecules[t]=s.animation_special_style_prework(e),s.molecules_parsing[t]++});{Papa.parse(n,{dynamicTyping:!0,worker:!0,download:!0,delimiter:" ",complete:function(e){if(!e)return console.log("dissipation: could not parse temperatures."),!1;for(var i=0;i<e.data.length;i++)for(var a=0;a<e.data[i].length;a++)e.data[i][a]=parseFloat(e.data[i][a]);s.temperatures[t]=e.data,s.colors[t]=s.make_colors(s.temperatures[t])[0],s.energy_molecule_substrate[t]=s.calc_energy_molecule_substrate(s.temperatures[t],R,P)[0],s.molecules_parsing[t]++}})}setTimeout(function(){s.timeout=s.show(t,o,n)},1e3*a)}}};