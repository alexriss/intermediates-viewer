/**
 * @author Eberhard Graether / http://egraether.com/
 */
THREE.TrackballControls=function(e,t){function o(e){p.enabled!==!1&&(window.removeEventListener("keydown",o),E=g,g===d.NONE&&(e.keyCode!==p.keys[d.ROTATE]||p.noRotate?e.keyCode!==p.keys[d.ZOOM]||p.noZoom?e.keyCode!==p.keys[d.PAN]||p.noPan||(g=d.PAN):g=d.ZOOM:g=d.ROTATE))}function n(){p.enabled!==!1&&(g=E,window.addEventListener("keydown",o,!1))}function s(e){p.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),g===d.NONE&&(g=e.button),g!==d.ROTATE||p.noRotate?g!==d.ZOOM||p.noZoom?g!==d.PAN||p.noPan||(w=j=p.getMouseOnScreen(e.clientX,e.clientY)):O=v=p.getMouseOnScreen(e.clientX,e.clientY):f=b=p.getMouseProjectionOnBall(e.clientX,e.clientY),document.addEventListener("mousemove",i,!1),document.addEventListener("mouseup",a,!1))}function i(e){p.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),g!==d.ROTATE||p.noRotate?g!==d.ZOOM||p.noZoom?g!==d.PAN||p.noPan||(j=p.getMouseOnScreen(e.clientX,e.clientY)):v=p.getMouseOnScreen(e.clientX,e.clientY):b=p.getMouseProjectionOnBall(e.clientX,e.clientY))}function a(e){p.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),g=d.NONE,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",a))}function c(e){if(p.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),O.y+=.01*t}}function r(e){if(p.enabled!==!1)switch(e.touches.length){case 1:g=d.TOUCH_ROTATE,f=b=p.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:g=d.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;T=y=Math.sqrt(t*t+o*o);break;case 3:g=d.TOUCH_PAN,w=j=p.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;default:g=d.NONE}}function h(e){if(p.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:b=p.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;T=Math.sqrt(t*t+o*o);break;case 3:j=p.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;default:g=d.NONE}}function u(e){if(p.enabled!==!1){switch(e.touches.length){case 1:f=b=p.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:y=T=0;break;case 3:w=j=p.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)}g=d.NONE}}var p=this,d={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var l=new THREE.Vector3,g=d.NONE,E=d.NONE,m=new THREE.Vector3,f=new THREE.Vector3,b=new THREE.Vector3,O=new THREE.Vector2,v=new THREE.Vector2,y=0,T=0,w=new THREE.Vector2,j=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var M={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth,this.screen.height=window.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new THREE.Vector2((e-p.screen.offsetLeft)/p.radius*.5,(t-p.screen.offsetTop)/p.radius*.5)},this.getMouseProjectionOnBall=function(e,t){var o=new THREE.Vector3((e-.5*p.screen.width-p.screen.offsetLeft)/p.radius,(.5*p.screen.height+p.screen.offsetTop-t)/p.radius,0),n=o.length();n>1?o.normalize():o.z=Math.sqrt(1-n*n),m.copy(p.object.position).sub(p.target);var s=p.object.up.clone().setLength(o.y);return s.add(p.object.up.clone().cross(m).setLength(o.x)),s.add(m.setLength(o.z)),s},this.rotateCamera=function(){var e=Math.acos(f.dot(b)/f.length()/b.length());if(e){var t=(new THREE.Vector3).crossVectors(f,b).normalize(),o=new THREE.Quaternion;e*=p.rotateSpeed,o.setFromAxisAngle(t,-e),m.applyQuaternion(o),p.object.up.applyQuaternion(o),b.applyQuaternion(o),p.staticMoving?f.copy(b):(o.setFromAxisAngle(t,e*(p.dynamicDampingFactor-1)),f.applyQuaternion(o))}},this.zoomCamera=function(){if(g===d.TOUCH_ZOOM){var e=y/T;y=T,m.multiplyScalar(e)}else{var e=1+(v.y-O.y)*this.zoomSpeed;1!==e&&e>0&&(this.object instanceof THREE.PerspectiveCamera?m.multiplyScalar(e):(this.object.left*=e,this.object.right*=e,this.object.top*=e,this.object.bottom*=e,this.object.updateProjectionMatrix()),p.staticMoving?O.copy(v):O.y+=(v.y-O.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var e=j.clone().sub(w);if(e.lengthSq()){e.multiplyScalar(m.length()*p.panSpeed);var t=m.clone().cross(p.object.up).setLength(e.x);t.add(p.object.up.clone().setLength(e.y)),p.object.position.add(t),p.target.add(t),p.staticMoving?w=j:w.add(e.subVectors(j,w).multiplyScalar(p.dynamicDampingFactor))}},this.checkDistances=function(){p.noZoom&&p.noPan||(p.object.position.lengthSq()>p.maxDistance*p.maxDistance&&p.object.position.setLength(p.maxDistance),m.lengthSq()<p.minDistance*p.minDistance&&p.object.position.addVectors(p.target,m.setLength(p.minDistance)))},this.update=function(){m.subVectors(p.object.position,p.target),p.noRotate||p.rotateCamera(),p.noZoom||p.zoomCamera(),p.noPan||p.panCamera(),p.object.position.addVectors(p.target,m),p.checkDistances(),p.object.lookAt(p.target),l.distanceToSquared(p.object.position)>0&&(p.dispatchEvent(M),l.copy(p.object.position))},this.reset=function(){g=d.NONE,E=d.NONE,p.target.copy(p.target0),p.object.position.copy(p.position0),p.object.up.copy(p.up0),m.subVectors(p.object.position,p.target),p.object.lookAt(p.target),p.dispatchEvent(M),l.copy(p.object.position)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",s,!1),this.domElement.addEventListener("mousewheel",c,!1),this.domElement.addEventListener("DOMMouseScroll",c,!1),this.domElement.addEventListener("touchstart",r,!1),this.domElement.addEventListener("touchend",u,!1),this.domElement.addEventListener("touchmove",h,!1),window.addEventListener("keydown",o,!1),window.addEventListener("keyup",n,!1),this.handleResize()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);